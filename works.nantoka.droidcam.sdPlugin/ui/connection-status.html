<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Connection Status Settings</title>
    <link rel="stylesheet" href="inspector.css">
    <script src="i18n.js"></script>
    <script src="pi-common.js"></script>
    <script src="pi-components.js"></script>
</head>
<body>
    <div class="sdpi-wrapper" id="content">
        <!-- Content will be generated by JavaScript -->
    </div>

    <script>
        // Initialize Property Inspector
        const pi = new PICommon.PropertyInspector({ debug: false });
        
        // Initialize UI when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize i18n
            PIComponents.PIComponents.initializeI18n();
            
            // Get content container
            const content = document.getElementById('content');
            
            // Add connection settings
            content.appendChild(
                PIComponents.PIComponents.createConnectionSettings()
            );
            
            // Add check interval field
            const intervalField = PIComponents.PIComponents.createField({
                label: 'Auto-check Interval (seconds)',
                type: 'number',
                id: 'checkInterval',
                value: '5',
                min: 1,
                max: 60,
                dataSetting: 'checkInterval',
                i18nLabel: 'settings.interval',
                i18nPlaceholder: 'placeholder.interval',
                help: 'Check connection every N seconds',
                i18nHelp: 'help.check-interval'
            });
            content.appendChild(intervalField);
            
            // Add test connection button
            content.appendChild(
                PIComponents.PIComponents.createTestConnectionButton(async () => {
                    const ipAddress = document.getElementById('ipAddress').value;
                    const port = document.getElementById('port').value;
                    
                    if (!ipAddress) {
                        return {
                            success: false,
                            error: i18n.t('message.enter-ip', 'Please enter IP address or hostname')
                        };
                    }
                    
                    const result = await pi.testConnection(ipAddress, parseInt(port));
                    
                    // Save settings if successful
                    if (result.success) {
                        pi.saveSettings();
                    }
                    
                    return result;
                })
            );
            
            // Bind all inputs to settings
            pi.bindAllInputs();
            
            // Load initial settings
            pi.onSettingsChange((settings) => {
                if (settings.ipAddress) {
                    document.getElementById('ipAddress').value = settings.ipAddress;
                }
                if (settings.port) {
                    document.getElementById('port').value = settings.port;
                }
                if (settings.checkInterval) {
                    document.getElementById('checkInterval').value = settings.checkInterval;
                }
            });
        });
        
        // Setup Stream Deck connection
        PICommon.setupPropertyInspector(pi);
    </script>
</body>
</html>